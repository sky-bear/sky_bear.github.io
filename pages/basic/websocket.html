<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTML5 websocket | sky-bear</title>
    <meta name="description" content="sky-bear的网站">
    <link rel="icon" href="/image/icon.png">
    
    <link rel="preload" href="/assets/css/0.styles.e39f02ee.css" as="style"><link rel="preload" href="/assets/js/app.57300b5c.js" as="script"><link rel="preload" href="/assets/js/2.a91da3c3.js" as="script"><link rel="preload" href="/assets/js/12.7d3f6b00.js" as="script"><link rel="prefetch" href="/assets/js/10.e3fb5aae.js"><link rel="prefetch" href="/assets/js/11.8f94877a.js"><link rel="prefetch" href="/assets/js/13.a29adb03.js"><link rel="prefetch" href="/assets/js/14.121d1800.js"><link rel="prefetch" href="/assets/js/15.13ead928.js"><link rel="prefetch" href="/assets/js/16.c01f359f.js"><link rel="prefetch" href="/assets/js/17.e0b15777.js"><link rel="prefetch" href="/assets/js/18.f6126050.js"><link rel="prefetch" href="/assets/js/19.8d324419.js"><link rel="prefetch" href="/assets/js/3.65aa8bec.js"><link rel="prefetch" href="/assets/js/4.e8e7a060.js"><link rel="prefetch" href="/assets/js/5.8d3f9059.js"><link rel="prefetch" href="/assets/js/6.110d988e.js"><link rel="prefetch" href="/assets/js/7.da5c3669.js"><link rel="prefetch" href="/assets/js/8.5f9b00f3.js"><link rel="prefetch" href="/assets/js/9.142d423b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e39f02ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">sky-bear</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/basic/basic.html" class="nav-link">基础</a></div><div class="nav-item"><a href="/pages/javascript/async-await.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/pages/react/react.html" class="nav-link">react</a></div><div class="nav-item"><a href="/pages/vuepress/vuepress.html" class="nav-link">vuePress</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/basic/basic.html" class="nav-link">基础</a></div><div class="nav-item"><a href="/pages/javascript/async-await.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/pages/react/react.html" class="nav-link">react</a></div><div class="nav-item"><a href="/pages/vuepress/vuepress.html" class="nav-link">vuePress</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/basic/basic.html" class="sidebar-link">基础知识</a></li><li><a href="/pages/basic/copy.html" class="sidebar-link">javascript的复制</a></li><li><a href="/pages/basic/debounceAndThrottle.html" class="sidebar-link">防抖和节流</a></li><li><a href="/pages/basic/lazy.html" class="sidebar-link">图片懒加载</a></li><li><a href="/pages/basic/websocket.html" class="active sidebar-link">websocket的简单应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/basic/websocket.html#html5-websocket" class="sidebar-link">HTML5 websocket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/basic/websocket.html#什么是websocket？" class="sidebar-link">什么是webSocket？</a></li><li class="sidebar-sub-header"><a href="/pages/basic/websocket.html#作用" class="sidebar-link">作用</a></li><li class="sidebar-sub-header"><a href="/pages/basic/websocket.html#方法和使用" class="sidebar-link">方法和使用</a></li><li class="sidebar-sub-header"><a href="/pages/basic/websocket.html#demo" class="sidebar-link">demo</a></li></ul></li></ul></li><li><a href="/pages/basic/tetris.html" class="sidebar-link">俄罗斯方块的实现</a></li><li><a href="/pages/basic/typeChange.html" class="sidebar-link">js中的隐式转换</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="html5-websocket"><a href="#html5-websocket" aria-hidden="true" class="header-anchor">#</a> HTML5 websocket</h2> <h3 id="什么是websocket？"><a href="#什么是websocket？" aria-hidden="true" class="header-anchor">#</a> 什么是webSocket？</h3> <p>WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。</p> <p>WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。</p> <p>在 WebSocket API 中，浏览器和服务器只需要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。两者之间就直接可以数据互相传送。</p> <p>现在，很多网站为了实现推送技术，所用的技术都是 Ajax 轮询。轮询是在特定的的时间间隔（如每1秒），由浏览器对服务器发出HTTP请求，然后由服务器返回最新的数据给客户端的浏览器。这种传统的模式带来很明显的缺点，即浏览器需要不断的向服务器发出请求，然而HTTP请求可能包含较长的头部，其中真正有效的数据可能只是很小的一部分，显然这样会浪费很多的带宽等资源。</p> <p>HTML5 定义的 WebSocket 协议，能更好的节省服务器资源和带宽，并且能够更实时地进行通讯。</p> <h3 id="作用"><a href="#作用" aria-hidden="true" class="header-anchor">#</a> 作用</h3> <p>解决ajax轮询， 使前后端可以实时通讯， 能更好的节省服务器资源和带宽。</p> <h3 id="方法和使用"><a href="#方法和使用" aria-hidden="true" class="header-anchor">#</a> 方法和使用</h3> <ul><li><p><strong>创建对象</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">[</span>protocol<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第一个参数 url, 指定连接的 URL。第二个参数 protocol 是可选的，指定了可接受的子协议。</p></li> <li><p><strong>属性</strong></p> <table><thead><tr><th style="text-align:center;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">Socket.readyState</td> <td style="text-align:left;">只读属性 **<code>readyState**</code> 表示连接状态，可以是以下值：-0 - 表示连接尚未建立。 1 - 表示连接已建立，可以进行通信。 2 - 表示连接正在进行关闭。 3 - 表示连接已经关闭或者连接不能打开。</td></tr> <tr><td style="text-align:center;">Socket.bufferedAmount</td> <td style="text-align:left;">只读属性 **<code>bufferedAmount**</code> 已被 send() 放入正在队列中等待传输，但是还没有发出的 UTF-8 文本字节数。</td></tr></tbody></table></li> <li><p><strong>事件</strong></p> <table><thead><tr><th style="text-align:left;">事件</th> <th style="text-align:left;">事件处理程序</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">open</td> <td style="text-align:left;">Socket.onopen</td> <td style="text-align:left;">连接建立时触发</td></tr> <tr><td style="text-align:left;">message</td> <td style="text-align:left;">Socket.onmessage</td> <td style="text-align:left;">客户端接收服务端数据时触发</td></tr> <tr><td style="text-align:left;">error</td> <td style="text-align:left;">Socket.onerror</td> <td style="text-align:left;">通信发生错误时触发</td></tr> <tr><td style="text-align:left;">close</td> <td style="text-align:left;">Socket.onclose</td> <td style="text-align:left;">连接关闭时触发</td></tr></tbody></table></li> <li><p><strong>方法</strong></p> <table><thead><tr><th style="text-align:left;">方法</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">Socket.send()</td> <td style="text-align:left;">使用连接发送数据</td></tr> <tr><td style="text-align:left;">Socket.close()</td> <td style="text-align:left;">关闭连接</td></tr></tbody></table></li></ul> <h3 id="demo"><a href="#demo" aria-hidden="true" class="header-anchor">#</a> demo</h3> <ul><li><div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>webssocket<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>未连接<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>发送<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">const</span> websocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;ws://echo.websocket.org/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    websocket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;连接上了&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    websocket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;关闭了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    websocket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        websocket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>简单的创建<code>WebSocket</code>对象， 并在页面实现通讯</p> <p><img src="F:%5C%E5%B8%B8%E7%94%A8%E5%B7%A5%E4%BD%9C%E8%A1%A8%5Clearn%5Csky-bear%5C%E4%BF%84%E7%BD%97%E6%96%AF%E6%96%B9%E5%9D%97%E7%9A%84%E5%AE%9E%E7%8E%B0%5C%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%5Cimage%5Cwebsocket.png" alt=""></p></li> <li><p>通过使用<code>nodejs-websocket</code></p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span>js
<span class="token keyword">const</span> <span class="token constant">WS</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;nodejs-websocket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">9000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> createServer <span class="token operator">=</span> <span class="token constant">WS</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token parameter">connection</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;发送消息&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    connection<span class="token punctuation">.</span><span class="token function">sendText</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connect&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;开启连接&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;关闭连接&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  connection<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;异常关闭&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>
</code></pre></div></li> <li><p><code>socket.io</code>详细使用方法<a href="https://socket.io/" target="_blank" rel="noopener noreferrer">https://socket.io/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span>js
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;socket.io&quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;news&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> hello<span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;my other event&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/basic/lazy.html" class="prev">
          图片懒加载
        </a></span> <span class="next"><a href="/pages/basic/tetris.html">
          俄罗斯方块的实现
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.57300b5c.js" defer></script><script src="/assets/js/2.a91da3c3.js" defer></script><script src="/assets/js/12.7d3f6b00.js" defer></script>
  </body>
</html>
