<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js 中的隐式转换 | sky-bear</title>
    <meta name="description" content="sky-bear的网站">
    <link rel="icon" href="/image/icon.png">
    
    <link rel="preload" href="/assets/css/0.styles.e39f02ee.css" as="style"><link rel="preload" href="/assets/js/app.57300b5c.js" as="script"><link rel="preload" href="/assets/js/2.a91da3c3.js" as="script"><link rel="preload" href="/assets/js/11.8f94877a.js" as="script"><link rel="prefetch" href="/assets/js/10.e3fb5aae.js"><link rel="prefetch" href="/assets/js/12.7d3f6b00.js"><link rel="prefetch" href="/assets/js/13.a29adb03.js"><link rel="prefetch" href="/assets/js/14.121d1800.js"><link rel="prefetch" href="/assets/js/15.13ead928.js"><link rel="prefetch" href="/assets/js/16.c01f359f.js"><link rel="prefetch" href="/assets/js/17.e0b15777.js"><link rel="prefetch" href="/assets/js/18.f6126050.js"><link rel="prefetch" href="/assets/js/19.8d324419.js"><link rel="prefetch" href="/assets/js/3.65aa8bec.js"><link rel="prefetch" href="/assets/js/4.e8e7a060.js"><link rel="prefetch" href="/assets/js/5.8d3f9059.js"><link rel="prefetch" href="/assets/js/6.110d988e.js"><link rel="prefetch" href="/assets/js/7.da5c3669.js"><link rel="prefetch" href="/assets/js/8.5f9b00f3.js"><link rel="prefetch" href="/assets/js/9.142d423b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e39f02ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">sky-bear</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/basic/basic.html" class="nav-link">基础</a></div><div class="nav-item"><a href="/pages/javascript/async-await.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/pages/react/react.html" class="nav-link">react</a></div><div class="nav-item"><a href="/pages/vuepress/vuepress.html" class="nav-link">vuePress</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/basic/basic.html" class="nav-link">基础</a></div><div class="nav-item"><a href="/pages/javascript/async-await.html" class="nav-link">javaScript</a></div><div class="nav-item"><a href="/pages/react/react.html" class="nav-link">react</a></div><div class="nav-item"><a href="/pages/vuepress/vuepress.html" class="nav-link">vuePress</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pages/basic/basic.html" class="sidebar-link">基础知识</a></li><li><a href="/pages/basic/copy.html" class="sidebar-link">javascript的复制</a></li><li><a href="/pages/basic/debounceAndThrottle.html" class="sidebar-link">防抖和节流</a></li><li><a href="/pages/basic/lazy.html" class="sidebar-link">图片懒加载</a></li><li><a href="/pages/basic/websocket.html" class="sidebar-link">websocket的简单应用</a></li><li><a href="/pages/basic/tetris.html" class="sidebar-link">俄罗斯方块的实现</a></li><li><a href="/pages/basic/typeChange.html" class="active sidebar-link">js中的隐式转换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/basic/typeChange.html#隐式转换规则" class="sidebar-link">隐式转换规则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/basic/typeChange.html#toprimitive" class="sidebar-link">ToPrimitive</a></li><li class="sidebar-sub-header"><a href="/pages/basic/typeChange.html#tostring" class="sidebar-link">ToString</a></li><li class="sidebar-sub-header"><a href="/pages/basic/typeChange.html#tonumber" class="sidebar-link">ToNumber</a></li><li class="sidebar-sub-header"><a href="/pages/basic/typeChange.html#toboolean" class="sidebar-link">ToBoolean</a></li><li class="sidebar-sub-header"><a href="/pages/basic/typeChange.html#的判断规则（x-y）" class="sidebar-link">==的判断规则（x==y）</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/basic/typeChange.html#常见面试题" class="sidebar-link">常见面试题</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js-中的隐式转换"><a href="#js-中的隐式转换" aria-hidden="true" class="header-anchor">#</a> js 中的隐式转换</h1> <h2 id="隐式转换规则"><a href="#隐式转换规则" aria-hidden="true" class="header-anchor">#</a> 隐式转换规则</h2> <blockquote><p>所谓隐式转换就是在进行比较（==）或者运算的时进行的数据类型转换</p></blockquote> <h3 id="toprimitive"><a href="#toprimitive" aria-hidden="true" class="header-anchor">#</a> ToPrimitive</h3> <blockquote><p><code>Symbol.toPrimitive(input, PreferredType )</code>该对象操作接受一个参数 input 和一个可选的参数 PreferredType （[String, Number]）,如果不传默认是 default</p></blockquote> <ul><li><p>当对象类型进行转换时， 按照以下步骤（原始数据类型不转换）</p> <ul><li><p>如果 PreferredType 没有传，令 hint 为”default”</p></li> <li><p>如果 PreferredType 参数是 String 类型，那么令 hint 为”string”</p></li> <li><p>如果 PreferredType 参数是 Number 类型，那么令 hint 为”number”</p></li> <li><p>令 exoticToPrim 为 GetMethod(input, @@toPrimitive).【@@toPrimitive： Symbol.toPrimitive 的另一种写法】</p></li> <li><p>如果 exoticToPrim 不是 undefined，那么</p> <ul><li>令 result 为 Call(exoticToPrim, input, « hint »).</li> <li>如果 result 类型不是 Object，直接返回 result</li> <li>扔出 TypeError 异常</li></ul></li> <li><p>如果 hint 为”default”,令 hint 为”number”</p></li> <li><p>返回 OrdinaryToPrimitive(input, hint)的值【即 exoticToPrim 是不存在时使用这个函数】</p> <blockquote><p>当抽象方法 OrdinaryToPrimitive 被执行时【OrdinaryToPrimitive（O, hint）】，采用如下步骤</p> <ul><li>如果 hint 是&quot;string&quot;，让 methodNames 等于« &quot;toString&quot;, &quot;valueOf&quot; »</li> <li>如果 hint 是&quot;number&quot;，让 methodNames 等于« &quot;valueOf&quot;, &quot;toString&quot; »</li> <li>按顺序迭代列表 methodNames，对于每一个迭代值 name；
<ul><li>令 method 为 Get(O, name).</li> <li>如果 IsCallable(method)返回 true,然后
<ul><li>令 result 为 Call(method, O).</li> <li>如果 result 的类型不是 Object，返回 result</li></ul></li> <li>返回 TypeError<strong>异常</strong></li></ul></li></ul> <p>这里通过英文翻译过来比较生硬， 其实就是， 按照 methodNames 中的顺序，判断对象上是否有这个方法， 如果有执行这个方法，如果没有判断下个方法。 如果该方法的返回值是原始值类型，则直接返回， 否则继续按照上述规则有序判断， 直到所有方法都执行后， 返回值仍不是原始值， 则 TypeError</p></blockquote></li></ul></li> <li><p>总结一下有如下特点</p> <ul><li><p>ToPrimitive(input,hint)转换为原始类型的方法，根据 hint 目标类型进行转换。</p></li> <li><p>hint 只有两个值：String 和 Number</p></li> <li><p>如果没有传 hint，Date 类型的 input 的 hint 默认为 String,其他类型的 input 的 hint 默认为 Number</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> c <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;toString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

b<span class="token punctuation">.</span><span class="token function-variable function">valueOf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;valueOf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印</span>
toString
time<span class="token punctuation">:</span> Wed Feb <span class="token number">26</span> <span class="token number">2020</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">54</span> <span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">0800</span> <span class="token punctuation">(</span>中国标准时间<span class="token punctuation">)</span>
</code></pre></div><p>此时打印的是<code>toString</code>, 说明此时调用 ToPrimitive 时可选参数默认是 string</p></li></ul></li></ul> <ul><li><p><em>可以重写对象的@@toPrimitive 方法来覆盖这个行为</em></p> <blockquote><p>我们常见的数组和对象上都没有<code>Symbol.toPrimitive</code>这个属性的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  a<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">,</span>
  b<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">,</span>
  c<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [Function: [Symbol.toPrimitive]] undefined undefined</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
b<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">hint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Wed Feb 26 2020 18:03:51 GMT+0800 (GMT+08:00)</span>
我这里改写了@@toPrimitive， 但是不起作用 求指点
</code></pre></div><p>但是我们可以改写<code>Symbol.toPrimitive</code>, 我们看看如下例子</p> <ul><li><p>const a = [1] =&gt; a == 10 // true ？</p> <ol><li><p>方法 1</p> <div class="language-js extra-class"><pre class="language-js"><code>a<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">hint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>我们改写了<code>toPrimitive</code>的方法， 这样在进行比较时， 数组 a 优先调用<code>toPrimitive</code>都返回 10</p></li> <li><p>方法 2</p> <div class="language-js extra-class"><pre class="language-js"><code>a<span class="token punctuation">.</span><span class="token function-variable function">valueOf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>我们改写<code>valueOf</code>方法，也可以达到结果【原生<code>valueOf</code>返回当前对象本身】,当<code>Symbol.toPrimitive</code>不存在时， 默认 hint 是 number, 则优先调用<code>valueOf</code></p> <blockquote><p>那么<code>valueOf</code>和<code>Symbol.toPrimitive</code>有什么关系吗?</p> <p>个人观点： 首先上面可以看出数组和而普通对象上并没有部署<code>Symbol.toPrimitive</code>做这个方法， 但是我们在整个转化过程中， 假设部署过这个方法， 然后按照上面的步骤就行转换， 这也就是部署了<code>Symbol.toPrimitive</code>后直接返回结果， 不在执行后面的步骤</p></blockquote></li></ol></li></ul></blockquote></li> <li><p>Number 类型先判断 <code>valueOf()</code>方法的返回值，如果不是原始值，再判断<code>toString()</code>方法的返回值，如果还是不能转换成原始值就会报错</p></li> <li><p>String 类型先判断 <code>toString()</code>方法的返回值，如果不是，再判断 <code>valueOf()</code>方法的返回值，如果还是不能转换成原始值就会报错</p></li> <li><p>在实际转换中参数<code>PreferredType</code>根据实际期待转换的值确定， 为什么这么说呢， 我们看看以下例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一个没有提供 Symbol.toPrimitive 属性的对象，参与运算时的输出结果</span>
<span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj1<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;[object Object]&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1 <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;[object Object]&quot;</span>

<span class="token comment">// // 接下面声明一个对象，手动赋予了 Symbol.toPrimitive 属性，再来查看输出结果</span>
<span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10      -- hint 参数值是 &quot;number&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj2<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;hello&quot; -- hint 参数值是 &quot;string&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2 <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;true&quot;  -- hint 参数值是 &quot;default&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  hello</span>

<span class="token keyword">let</span> obj3 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>obj3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10  -- hint 参数值是 &quot;number&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>obj3<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  &quot;hello&quot; -- hint 参数值是 &quot;string&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj3 <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10 // 默认 参数defalut =&gt; hint =&gt; number</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello</span>
</code></pre></div><p>上面的例子取自 MDN， 后面 ob3 时我个人加的， 这里我们可以看出不同使用情况下， 期待对象转换成的类型即是传入的<code>PreferredType</code>参数，字符串模板期望的 string , 写在字符串前面的+期望是 number， 这样我们啦测试一下</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj3 <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
</code></pre></div><p>但是感觉有点不对呢，我们再次进行测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// toString: function() {</span>
  <span class="token comment">//   return 1;</span>
  <span class="token comment">// },</span>

  <span class="token comment">// valueOf: function() {</span>
  <span class="token comment">//   return 2;</span>
  <span class="token comment">// }</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">hint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number  2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>arr<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number  false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// default  false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number 1</span>
</code></pre></div><p>通过上述一些测试可以得出以下结论：</p> <p><strong>当代码执行时， 明确清楚 需要什么类型的原始值（string, number），参数就是默认的类型， 否则都是 default</strong></p></li></ul> <h3 id="tostring"><a href="#tostring" aria-hidden="true" class="header-anchor">#</a> ToString</h3> <blockquote><p>将参数转换成字符串</p></blockquote> <p>转换规则如下</p> <table><thead><tr><th>参数</th> <th>结果</th></tr></thead> <tbody><tr><td>undefined</td> <td>'undefined'</td></tr> <tr><td>null</td> <td>'null'</td></tr> <tr><td>布尔值</td> <td>转换为'true' 或 'false'</td></tr> <tr><td>数字</td> <td>数字转换字符串</td></tr> <tr><td>字符串</td> <td>无须转换</td></tr> <tr><td>对象(obj)</td> <td>先进行 ToPrimitive(obj, String)转换得到原始值，在进行 ToString 转换为字符串</td></tr></tbody></table> <h3 id="tonumber"><a href="#tonumber" aria-hidden="true" class="header-anchor">#</a> ToNumber</h3> <blockquote><p>根据参数类型转换成数字类型</p></blockquote> <table><thead><tr><th>参数</th> <th>结果</th></tr></thead> <tbody><tr><td>undefined</td> <td>NaN</td></tr> <tr><td>null</td> <td>+0</td></tr> <tr><td>布尔值</td> <td>true 转换 1，false 转换为+0</td></tr> <tr><td>数字</td> <td>无须转换</td></tr> <tr><td>字符串</td> <td>有字符串解析为数字，例如：‘324’转换为 324，‘qwer’转换为 NaN</td></tr> <tr><td>''(空字符)</td> <td>0</td></tr> <tr><td>对象(obj)</td> <td>先进行 ToPrimitive(obj, Number)转换得到原始值，在进行 ToNumber 转换为数字</td></tr></tbody></table> <h3 id="toboolean"><a href="#toboolean" aria-hidden="true" class="header-anchor">#</a> ToBoolean</h3> <blockquote><p>布尔值转换</p></blockquote> <table><thead><tr><th>参数</th> <th>结果</th></tr></thead> <tbody><tr><td>undefined</td> <td>false</td></tr> <tr><td>null</td> <td>false</td></tr> <tr><td>-0 +0</td> <td>false</td></tr> <tr><td>NaN</td> <td>false</td></tr> <tr><td>''(空字符串)</td> <td>false</td></tr> <tr><td>所有的对象</td> <td>true</td></tr></tbody></table> <h3 id="的判断规则（x-y）"><a href="#的判断规则（x-y）" aria-hidden="true" class="header-anchor">#</a> ==的判断规则（x==y）</h3> <ul><li><p>如果 Type(x)和 Type(y)相同，返回 x===y 的结果</p></li> <li><p>如果 Type(x)和 Type(y)不相同</p> <ul><li><p>如果 x 是 null，y 是 undefined，返回 true</p></li> <li><p>如果 x 是 undefined，y 是 null，返回 true</p></li> <li><p>如果 Type(x)是 Number，Type(y)是 String，返回 x==ToNumber(y) 的结果</p></li> <li><p>如果 Type(x)是 String，Type(y)是 Number，返回 ToNumber(x)==y 的结果</p></li> <li><p>如果 Type(x)是 Boolean，返回 ToNumber(x)==y 的结果</p></li> <li><p>如果 Type(y)是 Boolean，返回 x==ToNumber(y) 的结果</p></li> <li><p>如果 Type(x)是 String 或 Number 或 Symbol 中的一种并且 Type(y)是 Object，返回 x==ToPrimitive(y) 的结果</p></li> <li><p>如果 Type(x)是 Object 并且 Type(y)是 String 或 Number 或 Symbol 中的一种，返回 ToPrimitive(x)==y 的结果</p> <p>其他返回 false</p></li></ul></li></ul> <h2 id="常见面试题"><a href="#常见面试题" aria-hidden="true" class="header-anchor">#</a> 常见面试题</h2> <ul><li><p><code>{} + [] =&gt; ?</code> <code>[] + {} =&gt; ?</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token operator">=&gt;</span> <span class="token string">&quot;[object Object]&quot;</span>

为什么呢？
ji 中<span class="token punctuation">{</span><span class="token punctuation">}</span>解析时， 被当成了代码块执行， 所以 <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> 实际就是 <span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token function">toPrimitive</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token parameter">valueOf</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token parameter">不是原始值</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token parameter">toString</span> <span class="token operator">=&gt;</span> <span class="token string">''</span><span class="token punctuation">(</span><span class="token parameter">原始值</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token punctuation">(</span>转换成 number<span class="token punctuation">)</span>

而<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token function">toPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">toPrimitive</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">default</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">toPrimitive</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">default</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">toPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>number<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">toPrimitive</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> valueOf <span class="token operator">+</span> <span class="token parameter">valueOf</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>不是原始值<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token parameter">不是原始值</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> toString <span class="token operator">+</span> <span class="token parameter">toString</span> <span class="token operator">=&gt;</span> <span class="token string">''</span> <span class="token operator">+</span> <span class="token string">&quot;[object Object]&quot;</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;[object Object]&quot;</span>

这就是整个的计算过程
（<span class="token punctuation">{</span><span class="token punctuation">}</span>） <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;[object Object]&quot;</span> 用括号包起来就没问题了
</code></pre></div></li> <li><p><code>[] == !{} =&gt; ?</code></p> <ol><li>!的优先级高于 == ， 所以 {}转成 boolean 是 true =&gt; !{} =false</li> <li>当有一端是布尔值时， 转成成数字 false =&gt; 0 =&gt; [] == 0</li> <li>后面就是[] 转换成原始值， [] =&gt; valueof =&gt; [] =&gt; toString =&gt; '' 转成数字 =&gt; 0</li></ol></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  i<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function-variable function">toString</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span>i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
上面只写了一种， 所以只要我们了解规则之后，
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  i<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function-variable function">toString</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;toString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span>i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;valueOf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span>i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toPrimitive<span class="token punctuation">]</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hint <span class="token operator">==</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span>i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
这三种都行， 认选一种
</code></pre></div></li> <li><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span><span class="token function">NaN</span> <span class="token punctuation">(</span><span class="token parameter">火狐</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token string">&quot;[object Object][object Object]&quot;</span> <span class="token function">（谷歌）</span>
<span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token string">&quot;[object Object][object Object]&quot;</span> （谷歌<span class="token punctuation">,</span> 火狐）
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">NaN</span> <span class="token punctuation">(</span>谷歌， 火狐<span class="token punctuation">)</span>
</code></pre></div></li></ul> <p>参考文档：</p> <p><a href="https://www.php.cn/js-tutorial-410318.html" target="_blank" rel="noopener noreferrer">详解 ECMAScript7 规范中 ToPrimitive 抽象操作的知识（示例）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.jianshu.com/p/36217b8a41b6" target="_blank" rel="noopener noreferrer">js 中==和===的区别<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/basic/tetris.html" class="prev">
          俄罗斯方块的实现
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.57300b5c.js" defer></script><script src="/assets/js/2.a91da3c3.js" defer></script><script src="/assets/js/11.8f94877a.js" defer></script>
  </body>
</html>
